# Planning Poker サービス仕様書 (v1)

## 📏 概要

本サービスは、アジャイル開発における見積もり作業のための「Planning Poker」をWeb上で実現するリアルタイムアプリケーションです。

## 🌟 目的

- 認証不要で即座に利用可能なPlanning Pokerツールを提供
- 小規模なチームによる軽量な利用を想定
- リアルタイムで見積もり状況を同期
- データは永続化せず、セッション終了時に破棄

## 🏠 システム構成

### 📌 インフラ構成

| サービス     | 内容                                        |
| ------------ | ------------------------------------------- |
| Cloud Run    | Node.js + Socket.IOサーバー (WebSocket対応) |
| Docker       | Cloud Run向けのNodeアプリをパッケージング   |
| ストレージ   | 不使用。状態はメモリ上に保持                |
| データベース | 不使用                                      |
| 認証         | 不要 (完全匿名で参加可能)                   |

### 📚 技術スタック

| 層             | 技術              | 説明                       |
| -------------- | ----------------- | -------------------------- |
| フロントエンド | HTML + CSS + JS   | Reactなどは使用しない      |
| サーバー       | Node.js + Express | WebSocketサーバとして利用  |
| 通信           | Socket.IO         | 双方向通信エンジン         |
| 配信           | Cloud Run         | サーバレス構成で安価に運用 |

## 🔀 アプリ仕様

### 🌐 ルーム参加フロー

1. 任意のルームIDを入力し、ユーザー名を設定
2. サーバへ接続し、当該ルームにジョイン
3. 同一ルームIDで参加しているユーザー全員に状態が同期

### 🃏 ポーカー機能

| 機能           | 内容                                         |
| -------------- | -------------------------------------------- |
| 投票カード     | 1, 2, 3, 5, 8, 13, 21                        |
| 投票の記録     | ユーザーごとにメモリ上に投票値を保持         |
| 投票の公開     | いずれかのユーザーがボタンを押すと全員に公開 |
| 投票結果の表示 | 公開前は「❓」で表示、公開後には値を表示      |
| 再投票         | 同じルームで投票をやり直せる                 |

### 👥 ユーザー管理

- 識別対象: `socket.id`
- 表示名: ユーザー側で入力した名前
- 退出: ブラウザのタブ閉じなどで通知

## 🧐 データ構造

```js
rooms = {
  [roomId]: {
    users: {
      [socketId]: {
        name: "ユーザー名",
        vote: 5 // or null
      }
    },
    revealed: false
  }
}
```
> サーバー再起動または無通信時の自動スケールインで破棄

## 🔢 UI仕様

- ルームIDと名前を入力
- 投票ボタンを押して選択
- Revealボタンで結果公開
- 投票状況はSocket.IOにより同期

## 🔒 制約事項

- Cloud Runが複数インスタンスにスケールすると、同じroomIdでもデータが分散する可能性がある
- 小規模ユースに限定すれば問題なし
- サーバが停止するとデータは全て破棄

## 💰 GCPコスト

| 項目           | 内容                  |
| -------------- | --------------------- |
| Cloud Run      | 無料枠で十分運用可能  |
| Dockerビルド   | Cloud Build経由で無料 |
| データベース等 | 不使用                |
| 月額想定       | 約 ￥0〜数十円以内     |

## ‼️ 拡張案

- ルームID自動生成
- タイマー機能
- 結果の統計表示
- カードセットの切り替え
- CSSライブラリによる結果表示の整織

